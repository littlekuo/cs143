(*
 *  CS164 Fall 94
 *
 *  Programming Assignment 1
 *    Implementation of a simple stack machine.
 *
 *  Skeleton file
 *)


class List {
   -- Define operations on empty lists.
   isNil() : Bool { true };
   head()  : String { { abort(); 0; } };
   tail()  : List { { abort(); self; } };

   cons(i : String) : List {
      (new Cons).init(i, self)
   };

};


class Cons inherits List {
   car : String; -- The element in this list cell
   cdr : List;	-- The rest of the list

   isNil() : Bool { false };
   head()  : String { car };
   tail()  : List { cdr };

   init(i : String, rest : List) : List {
      {
	 car <- i;
	 cdr <- rest;
	 self;
      }
   };
};



class StackCommand {
    stack : List;

    execute(str : String) : Object{
        if(str = "e") then {
            if(stack.head() = "+") then {
                stack <- stack.tail();
                let op1 : Int <- a2i(stack.head()) in {
                       stack <- stack.tail();
                       let op2 : Int <- a2i(stack.head()) in {
                            stack <- stack.cons(i2a(op1 + op2));
                       }
                }
            } else 
            if(stack.head() = "s") then {
                stack <- stack.tail();
                let str1 : String <- stack.head() in {
                    stack <- stack.tail();
                    let str2 : String <- stack.head() in {
                        stack <- stack.cons(op1).cons(op2);
                    }
                }
            }
            else {} fi fi
            getStr();
        } else 
        if(str = "x") then {
            
        } else
        if(str = "d") then {
             let tempStack : List <- stack in {
                print_stack(tempStack);
                getStr();
             }
        } else {
            stack <- stack.cons(str);
            getStr();
        } 
        fi fi fi
    };


    getStr():Object {
        let str : String <- (new IO).in_string() in {
           execute(str);
        }
    };

    print_stack(l : List) : Object {
      if l.isNil() then (new IO).out_string("\n")
                   else {
                         (new IO).out_string(l.head());
                         (new IO).out_string("\n");
                          print_stack(l.tail());
		           }
      fi
   };

};




class Main inherits IO {
   
   command : StackCommand  <- new StackCommand;

   main() : Object {
      { command.getStr(); }
   };

};

